# 脚本设计

本文档记录了卡德里亚道具屋自动脚本的设计。

## 场景汇总

英文名|中文名|备注
---|---|---
Shop|店铺|
Town|城镇|店铺画面左下角按钮
Tavern|酒馆|店铺画面右下角按钮
Guild|商会|店铺左侧按钮
Deal|交易|点击店铺画面中一个人
Crafting|制造|道具列表
OrderHelp|商会求助|商会其他成员的求助
ShopOrder|商铺订单|酒馆里等着的商铺人员
Bank|卡德里亚银行|酒馆里等着的银行人员
FactionWar|势力战争|
Battle|势力战争里的战斗|有“选择难度”（未开始）和"队伍已返回“两种状态。
Preparation|势力战争里的筹备|
Factions|三大势力|左中右三个势力
FactionOrders|单个势力订单|单个势力内部
Adventure|探险|探险地点列表
AdventureRecruitment|探险招募|单个探险地点，正在招募英雄
AdventureFinished|探险结束|成功或失败；可以修复英雄道具
RepairItem|修复道具|支付修复费用的弹窗，修复道具
CraftOneItem|制造道具|制造某个道具
BlueprintUpgraded|图纸升级|制造完成一个道具后图纸升级
BattleFinished|战斗结束|势力战争中的战斗，成功或失败；可以修复英雄的道具
BattleRecruitment|势力战争里的战斗的招募|势力战争中的战斗，正在招募英雄
RetrieveInterest|从银行里取钱|在银行点击取钱按钮后弹出的浮窗，上面有数额。


## 场景跳转图

```mermaid
    graph LR
        Shop[店铺]
        Tavern[酒馆]
        Guild[商会]
        Deal[交易]
        Crafting[制造]
        OrderHelp[商会求助]
        ShopOrder[商铺订单]
        Bank[卡德里亚银行]
        FactionWar[势力战争]
        Battle[势力战争里的战斗]
        Preparation[势力战争里的筹备]
        Factions[三大势力]
        FactionOrders[单个势力订单]
        Adventure[探险地点列表]
        AdventureRecruitment[探险招募]
        AdventureFinished[探险结束]
        RepairItem[修复道具]
        CraftOneItem[制造单个道具]
        BlueprintUpgraded[图纸升级]
        BattleFinished[战斗结束]
        BattleRecruitment[势力战争里的战斗的招募]
        RetrieveInterest[从银行里取钱]
        Shop --> Tavern
        Shop --> Guild
        Shop --> Crafting
        Shop --> Deal
        Guild --> OrderHelp
        Shop --> ShopOrder
        Tavern --> Bank
        Tavern --> FactionWar
        FactionWar --> Battle
        FactionWar --> Preparation
        Tavern --> Factions
        Factions --> FactionOrders
        Tavern --> Adventure
        Adventure --> AdventureRecruitment
        Tavern --> AdventureFinished
        AdventureFinished --F--> RepairItem
        Crafting --> CraftOneItem
        Shop --> BlueprintUpgraded
        Battle --> BattleFinished
        BattleFinished --F--> RepairItem
        Battle --> BattleRecruitment
        Bank --> RetrieveInterest
```

## 任务

### 银行


```mermaid
    graph TD
        其他任何界面 --> 店铺
        店铺 --> 酒馆
        酒馆 --> 银行
        银行 --已到期--> 取款
        取款 --> 存款
        银行 --无存款--> 存款
        银行 --进行中--> 结束((结束))
        存款 --> 结束
```

### 交易

```mermaid
    graph TD
        其他任何界面 --> 店铺
        店铺 --> 交易画面
        交易画面 --收购--> 结束((结束))
        交易画面 --出售_有货--> 结束((结束))
        交易画面 --出售_无货_有可推荐商品--> 交易画面
        交易画面 --出售_无货_无可推荐商品--> 结束((结束))
```


### 势力战争

```mermaid
    graph TD
        其他任何界面 --> 店铺
        店铺 --> 酒馆
        酒馆 --> 势力战争
        势力战争 --如果是筹备阶段则点击--> 筹备
        筹备 --有足够道具则提交--> 筹备
        筹备 --没有足够道具_有制造栏--> 制造道具
        制造道具 --材料充足则制造--> 筹备
        制造道具 --材料不足--> 结束((结束))
        筹备 --没有足够道具_无制造栏--> 结束
        势力战争 --如果是战斗阶段则点击--> 战斗
        战斗 --如果战斗未开始则选择难度--> 选择英雄画面
        战斗 --如果队伍已返回则点击--> 战斗结束画面
        战斗结束画面 --如果有道具需要修理--> 道具修理弹窗
        战斗结束画面 --如果没有道具需要修理--> 结束
        道具修理弹窗 --> 结束
        选择英雄画面 --如果有足够多的英雄--> 战斗
        选择英雄画面 --如果没有足够多的英雄--> 结束
```

